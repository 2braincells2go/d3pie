!function(a,b,c){"use strict";function d(c,d){return this.element=c,this.options=a.extend(!0,{},e,d),b.d3&&b.d3.hasOwnProperty("version")?(this._defaults=e,this._name=k,void this.init()):void console.error("d3pie error: d3 is not available")}var e={header:{title:{color:"#333333",fontSize:"14px",font:"helvetica"},subtitle:{color:"#333333",fontSize:"14px",font:"helvetica"},location:"top-left"},footer:{text:""},size:{canvasHeight:500,canvasWidth:500,pieInnerRadius:"100%",pieOuterRadius:null},labels:{inside:"percentage",outisde:"label",hideLabelsForSmallSegments:!1,hideLabelsForSmallSegmentSize:"0%"},styles:{backgroundColor:null,colors:["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00","#635222","#00dd00"]},effects:{load:{effect:"default",speed:1e3},pullOutSegmentOnClick:{effect:"linear",speed:400},highlightSegmentOnMouseover:!1,labelFadeInTime:400},tooltips:{enable:!1},callbacks:{onload:null,onMouseoverSegment:null,onMouseoutSegment:null,onClickSegment:null},misc:{cssPrefix:"auto",dataSortOrder:"none",canvasPadding:{top:5,right:5,bottom:5,left:5},titleSubtitlePadding:5,footerPiePadding:0,labelPieDistance:16,textSelectable:!1}};d.validate={},d.helpers={addSVGSpace:function(a,b,c,d){g=d3.select(a).append("svg:svg").attr("width",b).attr("height",c),"transparent"!==h.styles.backgroundColor&&g.style("background-color",function(){return d})},toRadians:function(a){return a*(Math.PI/180)},toDegrees:function(a){return a*(180/Math.PI)},whenIdExists:function(a,b){var d=1,e=1e3,f=setInterval(function(){c.getElementById(a)&&(clearInterval(f),b()),d>e&&clearInterval(f),d++},1)},shuffleArray:function(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},processObj:function(a,b,c){return"string"==typeof b?d.helpers.processObj(a,b.split("."),c):1==b.length&&void 0!==c?a[b[0]]=c:0==b.length?a:d.helpers.processObj(a[b[0]],b.slice(1),c)},getHeight:function(a){var b=c.getElementById(a).getBBox();return b.height},getWidth:function(a){var b=c.getElementById(a).getBBox();return b.width}},d.math={computePieRadius:function(){var a,b=h.size.canvasWidth-h.misc.canvasPadding.left-h.misc.canvasPadding.right,c=h.size.canvasHeight,d=(c>b?b:c)/2.8;if(null!==h.size.pieOuterRadius)if(/%/.test(h.size.pieOuterRadius)){var e=parseInt(h.size.pieOuterRadius.replace(/[\D]/,""),10);e=e>99?99:e,e=0>e?0:e;var f=c>b?b:c;d=Math.floor(f/100*e)/2}else d=parseInt(h.size.pieOuterRadius,10);if(/%/.test(h.size.pieInnerRadius)){var e=parseInt(h.size.pieInnerRadius.replace(/[\D]/,""),10);e=e>99?99:e,e=0>e?0:e,a=Math.floor(d/100*e)}else a=parseInt(h.size.pieInnerRadius,10);return{inner:a,outer:d}},getTotalPieSize:function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].value;return b},sortPieData:function(a,b){switch(b){case"none":break;case"random":a=d.helpers.shuffleArray(a);break;case"value-asc":a.sort(function(a,b){return a.value<b.value?1:-1});break;case"value-desc":a.sort(function(a,b){return a.value>b.value?1:-1});break;case"label-asc":a.sort(function(a,b){return a.label.toLowerCase()>b.label.toLowerCase()?1:-1});break;case"label-desc":a.sort(function(a,b){return a.label.toLowerCase()<b.label.toLowerCase()?1:-1})}return a},getPieTranslateCenter:function(){var a=d.math.getPieCenter();return"translate("+a.x+","+a.y+")"},getPieCenter:function(){var a=m&&"pie-center"!==h.header.location,b=n&&"pie-center"!==h.header.location,d=h.misc.canvasPadding.top;a&&b?d=parseInt(d3.select(c.getElementById("subtitle")).attr("y"),10)+h.misc.titleSubtitlePadding:a?d=parseInt(d3.select(c.getElementById("title")).attr("y"),10):b&&(d=parseInt(d3.select(c.getElementById("subtitle")).attr("y"),10));var e=0;return o&&(e=_getFooterHeight()+h.misc.canvasPadding.bottom),{x:(h.size.canvasWidth-h.misc.canvasPadding.right)/2+h.misc.canvasPadding.left,y:(h.size.canvasHeight-e)/2+d}},arcTween:function(a){var b=d3.interpolate({value:0},a);return function(a){return f(b(a))}},getSegmentRotationAngle:function(a,b,c){for(var d=0,e=0;a>e;e++)try{d+=b[e].value}catch(f){console.error("error in _getSegmentRotationAngle:",b,e)}return d/c*360}},d.labels={add:function(){var b=g.selectAll(".labelGroup").data(h.data.filter(function(a){return a.value}),function(a){return a.label}).enter().append("g").attr("class","labelGroup").attr("id",function(a,b){return"labelGroup"+b}).attr("transform",d.math.getPieTranslateCenter);b.append("text").attr("class","segmentLabel").attr("id",function(a,b){return"label"+b}).text(function(a){return a.label}).style("font-size","8pt").style("fill",h.labels.labelColor).style("opacity",0);var c="default"===h.effects.load.effect?h.effects.load.speed:1;setTimeout(function(){var b="default"===h.effects.load.effect?h.effects.labelFadeInTime:1;d3.selectAll("text.segmentLabel").transition().duration(b).style("opacity",1),a.isFunction(h.callbacks.onload)&&setTimeout(function(){try{h.callbacks.onload()}catch(a){}},b)},c),setTimeout(d.labels.addLabelLines,1)},addLabelLines:function(){var a=h.misc.labelPieDistance-h.misc.labelPieDistance/4,b=[];d3.selectAll(".segmentLabel").style("opacity",0).attr("dx",function(e,f){var g=c.getElementById("label"+f).getBBox(),i=d.math.getSegmentRotationAngle(f,h.data,p),k=360;f<h.data.length-1&&(k=d.math.getSegmentRotationAngle(f+1,h.data,p));var l,m,n,o,q=i+(k-i)/2,r=q%90,s=Math.floor(q/90),t=10;switch(s){case 0:var u=Math.sin(d.helpers.toRadians(r));o=u*(j+h.misc.labelPieDistance)+t,l=u*j,m=u*(j+a),n=u*(j+h.misc.labelPieDistance)+5;break;case 1:var v=Math.cos(d.helpers.toRadians(r));o=v*(j+h.misc.labelPieDistance)+t,l=v*j,m=v*(j+a),n=v*(j+h.misc.labelPieDistance)+5;break;case 2:var w=Math.sin(d.helpers.toRadians(r));o=-w*(j+h.misc.labelPieDistance)-g.width-t,l=-w*j,m=-w*(j+a),n=-w*(j+h.misc.labelPieDistance)-5;break;case 3:var x=Math.cos(d.helpers.toRadians(r));o=-x*(j+h.misc.labelPieDistance)-g.width-t,l=-x*j,m=-x*(j+a),n=-x*(j+h.misc.labelPieDistance)-5}return b[f]=[{x:l,y:null},{x:m,y:null},{x:n,y:null}],o}).attr("dy",function(e,f){var g=c.getElementById("label"+f).getBBox(),i=g.height/5,k=d.math.getSegmentRotationAngle(f,h.data,p),l=360;f<h.data.length-1&&(l=d.math.getSegmentRotationAngle(f+1,h.data,p));var m,n,o,q,r=k+(l-k)/2,s=r%90,t=Math.floor(r/90);switch(t){case 0:var u=Math.cos(d.helpers.toRadians(s));q=-u*(j+h.misc.labelPieDistance),m=-u*j,n=-u*(j+a),o=-u*(j+h.misc.labelPieDistance)-i;break;case 1:var v=Math.sin(d.helpers.toRadians(s));q=v*(j+h.misc.labelPieDistance),m=v*j,n=v*(j+a),o=v*(j+h.misc.labelPieDistance)-i;break;case 2:var w=Math.cos(d.helpers.toRadians(s));q=w*(j+h.misc.labelPieDistance),m=w*j,n=w*(j+a),o=w*(j+h.misc.labelPieDistance)-i;break;case 3:var x=Math.sin(d.helpers.toRadians(s));q=-x*(j+h.misc.labelPieDistance),m=-x*j,n=-x*(j+a),o=-x*(j+h.misc.labelPieDistance)-i}return b[f][0].y=m,b[f][1].y=n,b[f][2].y=o,q});var e=g.insert("g",".pieChart").attr("class","lineGroups").style("opacity",0),f=e.selectAll(".lineGroup").data(b).enter().append("g").attr("class","lineGroup").attr("transform",d.math.getPieTranslateCenter),i=d3.svg.line().interpolate("basis").x(function(a){return a.x}).y(function(a){return a.y});f.append("path").attr("d",i).attr("stroke","#666666").attr("stroke-width",1).attr("fill","none");var k="default"===h.effects.load.effect?h.effects.load.speed:1;setTimeout(function(){var a="default"===h.effects.load.effect?h.effects.labelFadeInTime:1;d3.selectAll("g.lineGroups").transition().duration(a).style("opacity",1)},k)}},d.segments={create:function(){console.log(d.math.getPieTranslateCenter());var a=g.append("g").attr("transform",d.math.getPieTranslateCenter).attr("class","pieChart");f=d3.svg.arc().innerRadius(i).outerRadius(j).startAngle(0).endAngle(function(a){var b=a.value/p*2*Math.PI;return b});var b=a.selectAll(".arc").data(h.data.filter(function(a){return a.value}),function(a){return a.label}).enter().append("g").attr("class",function(){var a="arc";return h.effects.highlightSegmentOnMouseover&&(a+=" arcHover"),a}),c=h.effects.load.speed;"none"===h.effects.load.effect&&(c=0),b.append("path").attr("id",function(a,b){return"segment"+b}).style("fill",function(a,b){return h.styles.colors[b]}).style("stroke","#ffffff").style("stroke-width",1).transition().ease("cubic-in-out").duration(c).attr("data-index",function(a,b){return b}).attrTween("d",d.math.arcTween),g.selectAll("g.arc").attr("transform",function(a,b){var c=d.math.getSegmentRotationAngle(b,h.data,p);return"rotate("+c+")"})},addSegmentEventHandlers:function(){var b=a(".arc");b.on("click",function(b){var c=a(b.currentTarget).find("path"),e="expanded"===c.attr("class");d.segments.onSegmentEvent(h.callbacks.onClickSegment,c,e),"none"!==h.effects.pullOutSegmentOnClick.effect&&(e?d.segments.closeSegment(c[0]):d.segments.openSegment(c[0]))}),b.on("mouseover",function(b){var c=a(b.currentTarget).find("path"),e="expanded"===c.attr("class");d.segments.onSegmentEvent(h.callbacks.onMouseoverSegment,c,e)}),b.on("mouseout",function(b){var c=a(b.currentTarget).find("path"),e="expanded"===c.attr("class");d.segments.onSegmentEvent(h.callbacks.onMouseoutSegment,c,e)})},onSegmentEvent:function(b,c,d){if(a.isFunction(b))try{var e=parseInt(c.data("index"),10);b({segment:c[0],index:e,expanded:d,data:h.data[e]})}catch(f){}},openSegment:function(b){a(".expanded").length>0&&d.pie.closeSegment(a(".expanded")[0]),d3.select(b).transition().ease(h.effects.pullOutSegmentOnClick.effect).duration(h.effects.pullOutSegmentOnClick.speed).attr("transform",function(a){var b=f.centroid(a),c=b[0],d=b[1],e=Math.sqrt(c*c+d*d),g=8;return"translate("+c/e*g+","+d/e*g+")"}).each("end",function(){a(this).attr("class","expanded")})},closeSegment:function(b){d3.select(b).transition().duration(400).attr("transform","translate(0,0)").each("end",function(){a(this).attr("class","")})}},d.text={offscreenCoord:-1e4,addTextElementsOffscreen:function(){m&&d.text.addTitle(),n&&d.text.addSubtitle()},addTitle:function(){var a=g.selectAll(".title").data([h.header.title]);a.enter().append("text").attr("id","title").attr("x",d3.text.offscreenCoord).attr("y",d3.text.offscreenCoord).attr("class","title").attr("text-anchor",function(){var a;return a="top-center"===h.header.location||"pie-center"===h.header.location?"middle":"left"}).attr("fill",function(a){return a.color}).text(function(a){return a.text}).style("font-size",function(a){return a.fontSize}).style("font-family",function(a){return a.font})},positionTitle:function(){l.title.h=d.helpers.getHeight("title");var a,b="top-left"===h.header.location?h.misc.canvasPadding.left:h.size.canvasWidth/2;a="pie-center"===h.header.location?(h.size.canvasHeight-h.misc.canvasPadding.bottom)/2+h.misc.canvasPadding.top+l.title.h/2:"pie-center"===h.header.location?h.size.canvasHeight/2:h.misc.canvasPadding.top+l.title.h,g.select("#title").attr("x",b).attr("y",a)},positionSubtitle:function(){var a,b=c.getElementById("subtitle"),d=b.getBBox(),e="top-left"===h.header.location?h.misc.canvasPadding.left:h.size.canvasWidth/2;if(""!==h.header.title.text){var f=parseInt(d3.select(c.getElementById("title")).attr("y"),10);a="pie-center"===h.header.location?h.size.canvasHeight/2:d.height+h.misc.titleSubtitlePadding+f}else a="pie-center"===h.header.location?h.size.canvasHeight/2:d.height+h.misc.canvasPadding.top;g.select("#subtitle").attr("x",e).attr("y",a)},addSubtitle:function(){""!==h.header.subtitle.text&&g.selectAll(".subtitle").data([h.header.subtitle]).enter().append("text").attr("x",d3.text.offscreenCoord).attr("y",d3.text.offscreenCoord).attr("id","subtitle").attr("class","subtitle").attr("text-anchor",function(){var a;return a="top-center"===h.header.location||"pie-center"===h.header.location?"middle":"left"}).attr("fill",function(a){return a.color}).text(function(a){return a.text}).style("font-size",function(a){return a.fontSize}).style("font-family",function(a){return a.font})},addFooter:function(){g.selectAll(".footer").data([h.footer]).enter().append("text").attr("x",d3.text.offscreenCoord).attr("y",d3.text.offscreenCoord).attr("id","footer").attr("class","footer").attr("text-anchor",function(){var a;return a="bottom-center"===h.footer.location?"middle":"bottom-right"===h.footer.location?"left":"left"}).attr("fill",function(a){return a.color}).text(function(a){return a.text}).style("font-size",function(a){return a.fontSize}).style("font-family",function(a){return a.font}),d.helpers.whenIdExists("footer",d.text.positionFooter)},positionFooter:function(){var a;if("bottom-left"===h.footer.location)a=h.misc.canvasPadding.left;else if("bottom-right"===h.footer.location){var b=c.getElementById("footer").getBBox();a=h.size.canvasWidth-b.width-h.misc.canvasPadding.right}else a=h.size.canvasWidth/2;g.select("#footer").attr("x",a).attr("y",h.size.canvasHeight-h.misc.canvasPadding.bottom)}};var f,g,h,i,j,k="d3pie",l={title:{h:0,w:0},subtitle:{h:0,w:0},topHeaderGroup:{h:0,w:0}},m=!1,n=!1,o=!1,p=null;a.fn[k]=function(b){return this.each(function(){a.data(this,k)||a.data(this,k,new d(this,b))})},d.prototype.destroy=function(){a(this.element).removeData(k),a(this.element).html("")},d.prototype.recreate=function(){a(this.element).html(""),this.init()},d.prototype.updateProp=function(b,c){switch(b){case"header.title.text":var e=d.helpers.processObj(this.options,b);d.helpers.processObj(this.options,b,c),a("#title").html(c),(""===e&&""!==c||""!==e&&""===c)&&this.recreate();break;case"header.subtitle.text":var e=d.helpers.processObj(this.options,b);d.helpers.processObj(this.options,b,c),a("#subtitle").html(c),(""===e&&""!==c||""!==e&&""===c)&&this.recreate();break;case"callbacks.onload":case"callbacks.onMouseoverSegment":case"callbacks.onMouseoutSegment":case"callbacks.onClickSegment":d.helpers.processObj(this.options,b,c)}},d.prototype.init=function(){h=this.options,h.data=d.math.sortPieData(h.data,h.misc.dataSortOrder),p=d.math.getTotalPieSize(h.data),d.helpers.addSVGSpace(this.element,h.size.canvasWidth,h.size.canvasHeight,h.styles.backgroundColor),m=""!==h.header.title.text,n=""!==h.header.subtitle.text,o=""!==h.footer.text,d.text.addTextElementsOffscreen(),d.text.addFooter();var a=d.math.computePieRadius();i=a.inner,j=a.outer,d.text.positionTitle(),d.text.positionSubtitle(),setTimeout(function(){d.segments.create(),d.labels.add(),d.segments.addSegmentEventHandlers()},5)}}(jQuery,window,document);